-- Создание таблицы для новостей/статей блога
CREATE TABLE IF NOT EXISTS blog_posts (
    id SERIAL PRIMARY KEY,
    title VARCHAR(500) NOT NULL,
    excerpt TEXT NOT NULL,
    content TEXT NOT NULL,
    category VARCHAR(100) NOT NULL,
    icon VARCHAR(50) NOT NULL DEFAULT 'FileText',
    read_time VARCHAR(20) NOT NULL DEFAULT '5 мин',
    image_url TEXT,
    published BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Создание индекса для быстрого поиска опубликованных постов
CREATE INDEX idx_blog_posts_published ON blog_posts(published, created_at DESC);
CREATE INDEX idx_blog_posts_category ON blog_posts(category);

-- Создание таблицы для настроек сайта
CREATE TABLE IF NOT EXISTS site_settings (
    id SERIAL PRIMARY KEY,
    key VARCHAR(100) UNIQUE NOT NULL,
    value TEXT NOT NULL,
    type VARCHAR(50) NOT NULL DEFAULT 'text',
    description TEXT,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Создание таблицы для заявок с форм
CREATE TABLE IF NOT EXISTS contact_requests (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact VARCHAR(255) NOT NULL,
    subject VARCHAR(500),
    message TEXT NOT NULL,
    source VARCHAR(100) NOT NULL DEFAULT 'contact_form',
    status VARCHAR(50) NOT NULL DEFAULT 'new',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Создание индекса для быстрого поиска заявок
CREATE INDEX idx_contact_requests_status ON contact_requests(status, created_at DESC);

-- Вставка начальных данных для блога
INSERT INTO blog_posts (title, excerpt, content, category, icon, read_time) VALUES
('5 ошибок в Яндекс Директ, которые сливают бюджет', 
 'Разбираю самые частые проблемы, с которыми сталкиваюсь в аудитах. Каждая из них стоит вам минимум 30% бюджета.',
 '## Ошибка 1: Нет минус-слов\n\nБольшинство начинающих специалистов забывают про минус-слова или добавляют их формально. Это приводит к тому, что реклама показывается по нецелевым запросам.\n\n## Ошибка 2: Одна кампания на всё\n\nКогда все товары/услуги собраны в одну кампанию, невозможно понять, что работает, а что нет. Разделяйте по направлениям.\n\n## Ошибка 3: Игнорирование РСЯ\n\nМногие считают РСЯ неэффективным каналом. На самом деле при правильной настройке он даёт до 40% лидов.\n\n## Ошибка 4: Не настроена аналитика\n\nБез Метрики и целей вы работаете вслепую. Установите все события правильно с первого дня.\n\n## Ошибка 5: Забыли про конкурентов\n\nАнализ конкурентов даёт бесценную информацию о том, какие ставки делать и как писать объявления.',
 'Ошибки', 'AlertTriangle', '7 мин'),

('Как снизить CPA на 40% за неделю: чек-лист из 12 пунктов',
 'Конкретные действия, которые можно выполнить прямо сейчас. Без сложных настроек и технических знаний.',
 '## Чек-лист оптимизации\n\n1. Проверьте минус-слова за последние 7 дней\n2. Отключите площадки РСЯ с конверсией < 0.5%\n3. Увеличьте ставки на топ-3 запроса\n4. Добавьте быстрые ссылки в объявления\n5. Настройте корректировки по времени суток\n6. Проверьте релевантность посадочных страниц\n7. Включите автотаргетинг на малообъёмную семантику\n8. Настройте ретаргетинг на брошенные корзины\n9. Добавьте UTM-метки для всех кампаний\n10. Оптимизируйте расписание показов\n11. Проверьте конкурентов в аукционе\n12. Протестируйте новые креативы',
 'Оптимизация', 'TrendingDown', '10 мин'),

('РСЯ в 2025: работает или нет? Мой опыт на 50+ проектах',
 'Честный разбор Рекламной сети Яндекса. В каких нишах РСЯ даёт результат, а где лучше не тратить деньги.',
 '## Где РСЯ работает отлично\n\n- E-commerce с чеком до 5000₽\n- Услуги с коротким циклом сделки\n- Инфопродукты и онлайн-курсы\n- B2C с импульсными покупками\n\n## Где РСЯ не работает\n\n- B2B с длинным циклом\n- Дорогие товары (>100 000₽)\n- Узкие профессиональные ниши\n- Услуги требующие личной встречи\n\n## Главные правила работы с РСЯ\n\n1. Отдельный бюджет (не более 30% от общего)\n2. Жёсткая чистка площадок каждую неделю\n3. Креативы должны быть яркими и цепляющими\n4. Обязательно используйте look-alike аудитории\n5. Тестируйте разные форматы объявлений',
 'Стратегия', 'Target', '12 мин'),

('Автостратегии Директа: когда включать и как не слить бюджет',
 'Подробный гайд по автоматическим стратегиям. Когда они работают лучше ручных ставок, а когда — категорически нет.',
 '## Типы автостратегий\n\n### Оптимизация кликов\nПодходит для новых кампаний без истории конверсий. Минимальный бюджет — 30 000₽/неделя.\n\n### Оптимизация конверсий\nРаботает только после 20+ конверсий. Лучший выбор для стабильных кампаний.\n\n### Средняя цена конверсии\nДля профи. Требует глубокого понимания экономики воронки.\n\n## Когда НЕ использовать автостратегии\n\n- Бюджет меньше 50 000₽/мес\n- Нет истории конверсий\n- Высокая сезонность\n- Частые изменения в кампаниях\n- Нестабильная конверсия сайта',
 'Настройка', 'Settings', '8 мин'),

('Минус-слова: как собрать список за 30 минут',
 'Простой метод, который использую сам. Экономит до 25% бюджета на неэффективных показах.',
 '## Метод сбора минус-слов\n\n### Шаг 1: Wordstat\nЗаходим в Вордстат и смотрим все запросы по вашей тематике. Выписываем нецелевые.\n\n### Шаг 2: Конкуренты\nСмотрим объявления конкурентов через Serpstat или SpyWords. Находим их минус-слова.\n\n### Шаг 3: Поисковые запросы\nЗаходим в Метрику → Отчёты → Поисковые фразы. Находим нецелевые запросы.\n\n### Шаг 4: РСЯ\nОтдельный список для РСЯ. Там другая логика работы запросов.\n\n## Частые минус-слова\n\n- бесплатно, даром, скачать\n- своими руками, сделать самому\n- отзывы, обзор, рейтинг\n- вакансии, работа, резюме\n- реферат, курсовая, диплом',
 'Оптимизация', 'Filter', '5 мин'),

('Конверсионные объявления: формула и 20 примеров',
 'Показываю структуру объявлений, которые получают CTR выше 10%. С реальными примерами из разных ниш.',
 '## Формула конверсионного объявления\n\n### Заголовок\n[Ключевое слово] + [УТП] + [Цифра]\nПример: "Настройка Яндекс Директ с гарантией результата за 3 дня"\n\n### Текст объявления\n- Боль или желание клиента\n- Ваше решение\n- Социальное доказательство\n- Призыв к действию\n\n### Быстрые ссылки\n- Конкретная выгода\n- Без воды\n- С цифрами\n\n## Примеры объявлений\n\n**Для e-commerce:**\n"Женские кроссовки Nike - Скидка 30% | Доставка за 1 день"\n\n**Для услуг:**\n"Ремонт квартир под ключ - Договор + гарантия 3 года"\n\n**Для B2B:**\n"Аутсорс IT-отдела - От 50 000₽/мес | 24/7 поддержка"',
 'Объявления', 'FileText', '15 мин');

-- Вставка базовых настроек сайта
INSERT INTO site_settings (key, value, type, description) VALUES
('site_title', 'DirectPro', 'text', 'Название сайта'),
('site_description', 'Контекстная реклама, которая окупается', 'text', 'Описание сайта'),
('hero_title', 'Контекстная реклама, которая окупается', 'text', 'Заголовок главного экрана'),
('hero_subtitle', 'Настройка Яндекс Директ под ключ. Без переплат за клики. Только целевые лиды. Гарантия результата.', 'text', 'Подзаголовок главного экрана'),
('contact_phone', '+7 (999) 123-45-67', 'text', 'Контактный телефон'),
('contact_email', 'info@directpro.ru', 'email', 'Email для связи'),
('telegram_username', '@directpro_telegram', 'text', 'Username в Telegram'),
('whatsapp_phone', '79991234567', 'text', 'Номер WhatsApp');
